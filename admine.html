<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gửi Thông tin Thiết bị & Vị trí</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f3f4f6; }
.container { background: #fff; padding: 2rem; border-radius: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 28rem; width: 90%; text-align:center; }
.btn { background:#4f46e5; color:#fff; padding:0.75rem 2rem; border-radius:0.75rem; cursor:pointer; border:none; width:100%; }
.btn:hover { background:#4338ca; }
#message { margin-top:1rem; color:#6b7280; }
</style>
</head>
<body>
<div class="container">
<h1 class="text-xl font-bold mb-4">Gửi Thông tin Thiết bị & Vị trí</h1>
<p class="mb-4">Nhấn nút bên dưới để gửi thông tin thiết bị và vị trí.</p>
<button id="sendBtn" class="btn">Gửi</button>
<p id="message"></p>
</div>

<script>
document.getElementById('sendBtn').addEventListener('click', async () => {
    const webhookUrl = 'YOUR_WEBHOOK_URL';
    const messageEl = document.getElementById('message');
    messageEl.textContent = 'Đang lấy thông tin...';

    function getDeviceInfoFromUserAgent(userAgent) {
        let brand = 'Không xác định';
        let model = 'Không xác định';
        if (/iPhone/.test(userAgent)) { brand='Apple'; model='iPhone'; }
        else if (/iPad/.test(userAgent)) { brand='Apple'; model='iPad'; }
        else if (/Android/.test(userAgent)) { brand='Android'; model='Thiết bị Android'; }
        else if (/Windows/.test(userAgent)) { brand='Microsoft'; model='PC Windows'; }
        else if (/Macintosh/.test(userAgent)) { brand='Apple'; model='Mac'; }
        return { brand, model };
    }

    try {
        // Lấy IP public
        const ipRes = await fetch('https://api64.ipify.org?format=json');
        const ipData = await ipRes.json();
        const ipAddress = ipData.ip;

        const ua = navigator.userAgent;
        const { brand, model } = getDeviceInfoFromUserAgent(ua);

        // Lấy vị trí
        const getLocation = () => new Promise((resolve, reject) => {
            if (!navigator.geolocation) return resolve(null);
            navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true });
        });

        let location = await getLocation();
        let lat = location?.coords.latitude ?? 'Không xác định';
        let lon = location?.coords.longitude ?? 'Không xác định';

        let address = 'Không xác định';
        if (lat !== 'Không xác định') {
            const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const geoData = await geoRes.json();
            address = geoData.display_name || 'Không xác định';
        }

        const deviceInfo = {
            ipAddress,
            userAgent: ua,
            brand,
            model,
            platform: navigator.platform,
            language: navigator.language,
            screenWidth: window.screen.width,
            screenHeight: window.screen.height,
            devicePixelRatio: window.devicePixelRatio,
            onlineStatus: navigator.onLine,
            cookieEnabled: navigator.cookieEnabled,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            latitude: lat,
            longitude: lon,
            address,
            timestamp: new Date().toISOString()
        };

        const messageContent = `
**Thông tin thiết bị & vị trí:**
- **IP public:** \`${deviceInfo.ipAddress}\`
- **User Agent:** \`${deviceInfo.userAgent}\`
- **Hãng:** \`${deviceInfo.brand}\`
- **Model:** \`${deviceInfo.model}\`
- **Platform:** \`${deviceInfo.platform}\`
- **Ngôn ngữ:** \`${deviceInfo.language}\`
- **Độ phân giải:** \`${deviceInfo.screenWidth}x${deviceInfo.screenHeight}\`
- **Tỷ lệ pixel:** \`${deviceInfo.devicePixelRatio}\`
- **Trạng thái online:** \`${deviceInfo.onlineStatus ? "Online" : "Offline"}\`
- **Cookie:** \`${deviceInfo.cookieEnabled ? "Bật" : "Tắt"}\`
- **Timezone:** \`${deviceInfo.timezone}\`
- **Vị trí:** \`${deviceInfo.address}\`
- **Kinh độ / Vĩ độ:** \`${deviceInfo.longitude} / ${deviceInfo.latitude}\`
- **Thời gian:** \`${deviceInfo.timestamp}\`
        `;

        const webhookResponse = await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: messageContent })
        });

        messageEl.textContent = webhookResponse.ok ? 'Đã gửi thành công!' : `Lỗi gửi: ${webhookResponse.status}`;

    } catch (err) {
        console.error(err);
        messageEl.textContent = 'Lỗi khi lấy thông tin thiết bị hoặc vị trí.';
    }
});
</script>
</body>
</html>
